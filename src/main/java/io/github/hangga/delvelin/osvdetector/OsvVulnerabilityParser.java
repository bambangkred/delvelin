package io.github.hangga.delvelin.osvdetector;

import java.io.IOException;
import java.util.List;

import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import com.fasterxml.jackson.annotation.JsonProperty;
import com.fasterxml.jackson.databind.ObjectMapper;

@JsonIgnoreProperties(ignoreUnknown = true)
public class OsvVulnerabilityParser {

    @JsonProperty("vulns")
    private List<OsvVulnerability> vulns;

    public List<OsvVulnerability> getVulns() {
        return vulns;
    }

    public void setVulns(List<OsvVulnerability> vulns) {
        this.vulns = vulns;
    }

    @JsonIgnoreProperties(ignoreUnknown = true)
    public static class OsvVulnerability {

        @JsonProperty("id")
        private String id;

        @JsonProperty("summary")
        private String summary;

        @JsonProperty("details")
        private String details;

        @JsonProperty("aliases")
        private List<String> aliases;

        @JsonProperty("modified")
        private String modified;

        @JsonProperty("published")
        private String published;

        @JsonProperty("related")
        private List<String> related;

        @JsonProperty("database_specific")
        private DatabaseSpecific databaseSpecific;

        @JsonProperty("references")
        private List<Reference> references;

        @JsonProperty("severities")
        private List<Severity> severities;

        public static class DatabaseSpecific {

            @JsonProperty("github_reviewed_at")
            private String githubReviewedAt;

            @JsonProperty("github_reviewed")
            private boolean githubReviewed;

            @JsonProperty("severity")
            private String severity;

            @JsonProperty("cwe_ids")
            private List<String> cweIds;

            @JsonProperty("nvd_published_at")
            private String nvdPublishedAt;

            // Getters and Setters
            public String getGithubReviewedAt() {
                return githubReviewedAt;
            }

            public void setGithubReviewedAt(String githubReviewedAt) {
                this.githubReviewedAt = githubReviewedAt;
            }

            public boolean isGithubReviewed() {
                return githubReviewed;
            }

            public void setGithubReviewed(boolean githubReviewed) {
                this.githubReviewed = githubReviewed;
            }

            public String getSeverity() {
                return severity;
            }

            public void setSeverity(String severity) {
                this.severity = severity;
            }

            public List<String> getCweIds() {
                return cweIds;
            }

            public void setCweIds(List<String> cweIds) {
                this.cweIds = cweIds;
            }

            public String getNvdPublishedAt() {
                return nvdPublishedAt;
            }

            public void setNvdPublishedAt(String nvdPublishedAt) {
                this.nvdPublishedAt = nvdPublishedAt;
            }
        }

        public static class Reference {

            private String type;
            private String url;

            // Getters and Setters
            public String getType() {
                return type;
            }

            public void setType(String type) {
                this.type = type;
            }

            public String getUrl() {
                return url;
            }

            public void setUrl(String url) {
                this.url = url;
            }
        }

        public static class Severity {

            private String type;
            private String score;

            public String getType() {
                return type;
            }

            public void setType(String type) {
                this.type = type;
            }

            public String getScore() {
                return score;
            }

            public void setScore(String score) {
                this.score = score;
            }
        }

        // Getters and Setters for OsvVulnerability
        public String getId() {
            return id;
        }

        public void setId(String id) {
            this.id = id;
        }

        public String getSummary() {
            return summary;
        }

        public void setSummary(String summary) {
            this.summary = summary;
        }

        public String getDetails() {
            return details;
        }

        public void setDetails(String details) {
            this.details = details;
        }

        public List<String> getAliases() {
            return aliases;
        }

        public void setAliases(List<String> aliases) {
            this.aliases = aliases;
        }

        public String getModified() {
            return modified;
        }

        public void setModified(String modified) {
            this.modified = modified;
        }

        public String getPublished() {
            return published;
        }

        public void setPublished(String published) {
            this.published = published;
        }

        public List<String> getRelated() {
            return related;
        }

        public void setRelated(List<String> related) {
            this.related = related;
        }

        public DatabaseSpecific getDatabaseSpecific() {
            return databaseSpecific;
        }

        public void setDatabaseSpecific(DatabaseSpecific databaseSpecific) {
            this.databaseSpecific = databaseSpecific;
        }

        public List<Reference> getReferences() {
            return references;
        }

        public void setReferences(List<Reference> references) {
            this.references = references;
        }

        public List<Severity> getSeverities() {
            return severities;
        }

        public void setSeverities(List<Severity> severities) {
            this.severities = severities;
        }
    }

    public OsvVulnerabilityParser parseJson(String json) throws IOException {
        ObjectMapper objectMapper = new ObjectMapper();
        return objectMapper.readValue(json, OsvVulnerabilityParser.class);
    }
}

